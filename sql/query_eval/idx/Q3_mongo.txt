
{
  explainVersion: '2',
  stages: [
    {
      '$cursor': {
        queryPlanner: {
          namespace: 'spotify.tracks',
          parsedQuery: {},
          indexFilterSet: false,
          queryHash: '33B06002',
          planCacheShapeHash: '33B06002',
          planCacheKey: '1089408A',
          optimizationTimeMillis: 3,
          maxIndexedOrSolutionsReached: false,
          maxIndexedAndSolutionsReached: false,
          maxScansToExplodeReached: false,
          prunedSimilarIndexes: false,
          winningPlan: {
            isCached: false,
            queryPlan: {
              stage: 'GROUP',
              planNodeId: 4,
              inputStage: {
                stage: 'FETCH',
                planNodeId: 2,
                inputStage: {
                  stage: 'IXSCAN',
                  planNodeId: 1,
                  keyPattern: {
                    decade: 1,
                    popularity: -1
                  },
                  indexName: 'decade_1_popularity_-1',
                  isMultiKey: false,
                  multiKeyPaths: {
                    decade: [],
                    popularity: []
                  },
                  isUnique: false,
                  isSparse: false,
                  isPartial: false,
                  indexVersion: 2,
                  direction: 'forward',
                  indexBounds: {
                    decade: [
                      '[MinKey, MaxKey]'
                    ],
                    popularity: [
                      '[MaxKey, MinKey]'
                    ]
                  }
                }
              }
            },
            slotBasedPlan: {
              slots: '$$RESULT=s16 env: { s5 = {"decade" : 1, "popularity" : -1} }',
              stages: '[4] project [s16 = newObj("_id", s13, "top_tracks", s15)] \n' +
                '[4] project [s15 = getElement(s14, 0)] \n' +
                '[4] group [s13] [s14 = addToArrayCapped(newObj("id", s8, "name", s10, "popularity", s11), 104857600)] spillSlots[s12] mergingExprs[aggConcatArraysCapped(s12, 104857600)] \n' +
                '[4] project [s13 = (s9 ?: null)] \n' +
                '[2] nlj inner [] [s1, s2, s3, s4, s5] \n' +
                '    left \n' +
                '        [1] ixseek KS(0A0F0104) KS(F0F5FE04) s4 s1 s2 s3 lowPriority [] @"eb2ae5e4-34bd-4d97-81c5-5bea59129794" @"decade_1_popularity_-1" true \n' +
                '    right \n' +
                '        [2] limit 1ll \n' +
                '        [2] seek s1 s6 s7 s2 s3 s4 s5 none none [s8 = _id, s9 = decade, s10 = name, s11 = popularity] @"eb2ae5e4-34bd-4d97-81c5-5bea59129794" true false \n'
            }
          },
          rejectedPlans: []
        },
        executionStats: {
          executionSuccess: true,
          nReturned: 13,
          executionTimeMillis: 1412,
          totalKeysExamined: 586672,
          totalDocsExamined: 586672,
          executionStages: {
            stage: 'project',
            planNodeId: 4,
            nReturned: 13,
            executionTimeMillisEstimate: 1090,
            opens: 1,
            closes: 1,
            saveState: 49,
            restoreState: 49,
            isEOF: 1,
            projections: {
              '16': 'newObj("_id", s13, "top_tracks", s15) '
            },
            inputStage: {
              stage: 'project',
              planNodeId: 4,
              nReturned: 13,
              executionTimeMillisEstimate: 1060,
              opens: 1,
              closes: 1,
              saveState: 49,
              restoreState: 49,
              isEOF: 1,
              projections: {
                '15': 'getElement(s14, 0) '
              },
              inputStage: {
                stage: 'group',
                planNodeId: 4,
                nReturned: 13,
                executionTimeMillisEstimate: 1060,
                opens: 1,
                closes: 1,
                saveState: 49,
                restoreState: 49,
                isEOF: 1,
                groupBySlots: [
                  13
                ],
                expressions: {
                  '14': 'addToArrayCapped(newObj("id", s8, "name", s10, "popularity", s11), 104857600) ',
                  initExprs: {
                    '14': null
                  }
                },
                mergingExprs: {
                  '12': 'aggConcatArraysCapped(s12, 104857600) '
                },
                usedDisk: true,
                spills: 2,
                spilledBytes: 42430985,
                spilledRecords: 14,
                spilledDataStorageSize: 9859072,
                inputStage: {
                  stage: 'project',
                  planNodeId: 4,
                  nReturned: 586672,
                  executionTimeMillisEstimate: 387,
                  opens: 1,
                  closes: 1,
                  saveState: 49,
                  restoreState: 49,
                  isEOF: 1,
                  projections: {
                    '13': '(s9 ?: null) '
                  },
                  inputStage: {
                    stage: 'nlj',
                    planNodeId: 2,
                    nReturned: 586672,
                    executionTimeMillisEstimate: 386,
                    opens: 1,
                    closes: 1,
                    saveState: 49,
                    restoreState: 49,
                    isEOF: 1,
                    totalDocsExamined: 586672,
                    totalKeysExamined: 586672,
                    collectionScans: 0,
                    collectionSeeks: 586672,
                    indexScans: 0,
                    indexSeeks: 1,
                    indexesUsed: [
                      'decade_1_popularity_-1'
                    ],
                    innerOpens: 586672,
                    innerCloses: 1,
                    outerProjects: [],
                    outerCorrelated: [
                      1,
                      2,
                      3,
                      4,
                      5
                    ],
                    outerStage: {
                      stage: 'ixseek',
                      planNodeId: 1,
                      nReturned: 586672,
                      executionTimeMillisEstimate: 21,
                      opens: 1,
                      closes: 1,
                      saveState: 49,
                      restoreState: 49,
                      isEOF: 1,
                      indexName: 'decade_1_popularity_-1',
                      keysExamined: 586672,
                      seeks: 1,
                      numReads: 586673,
                      indexKeySlot: 4,
                      recordIdSlot: 1,
                      snapshotIdSlot: 2,
                      indexIdentSlot: 3,
                      outputSlots: [],
                      indexKeysToInclude: '00000000000000000000000000000000',
                      seekKeyLow: 'KS(0A0F0104) ',
                      seekKeyHigh: 'KS(F0F5FE04) '
                    },
                    innerStage: {
                      stage: 'limit',
                      planNodeId: 2,
                      nReturned: 586672,
                      executionTimeMillisEstimate: 283,
                      opens: 586672,
                      closes: 1,
                      saveState: 49,
                      restoreState: 49,
                      isEOF: 1,
                      limit: 1,
                      inputStage: {
                        stage: 'seek',
                        planNodeId: 2,
                        nReturned: 586672,
                        executionTimeMillisEstimate: 283,
                        opens: 586672,
                        closes: 1,
                        saveState: 49,
                        restoreState: 49,
                        isEOF: 0,
                        numReads: 586672,
                        recordSlot: 6,
                        recordIdSlot: 7,
                        seekRecordIdSlot: 1,
                        snapshotIdSlot: 2,
                        indexIdentSlot: 3,
                        indexKeySlot: 4,
                        indexKeyPatternSlot: 5,
                        scanFieldNames: [
                          '_id',
                          'decade',
                          'name',
                          'popularity'
                        ],
                        scanFieldSlots: [
                          8,
                          9,
                          10,
                          11
                        ]
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      nReturned: 13,
      executionTimeMillisEstimate: 1314
    },
    {
      '$project': {
        _id: true,
        decade: '$_id',
        top_tracks: {
          '$slice': [
            '$top_tracks',
            {
              '$const': 5
            }
          ]
        }
      },
      nReturned: 13,
      executionTimeMillisEstimate: 1410
    }
  ],
  queryShapeHash: 'C4888DF7AB5637F3B9DE200590C6E3180F30BCDC1E9A24648EB8CCD2CECFE87F',
  serverInfo: {
    host: 'Host-006.homenet.telecomitalia.it',
    port: 27017,
    version: '8.0.12',
    gitVersion: 'b60fc6875b5fb4b63cc0dbbd8dda0d6d6277921a'
  },
  serverParameters: {
    internalQueryFacetBufferSizeBytes: 104857600,
    internalQueryFacetMaxOutputDocSizeBytes: 104857600,
    internalLookupStageIntermediateDocumentMaxSizeBytes: 104857600,
    internalDocumentSourceGroupMaxMemoryBytes: 104857600,
    internalQueryMaxBlockingSortMemoryUsageBytes: 104857600,
    internalQueryProhibitBlockingMergeOnMongoS: 0,
    internalQueryMaxAddToSetBytes: 104857600,
    internalDocumentSourceSetWindowFieldsMaxMemoryBytes: 104857600,
    internalQueryFrameworkControl: 'trySbeRestricted',
    internalQueryPlannerIgnoreIndexWithCollationForRegex: 1
  },
  command: {
    aggregate: 'tracks',
    pipeline: [
      {
        '$sort': {
          decade: 1,
          popularity: -1
        }
      },
      {
        '$group': {
          _id: '$decade',
          top_tracks: {
            '$push': {
              id: '$_id',
              name: '$name',
              popularity: '$popularity'
            }
          }
        }
      },
      {
        '$project': {
          decade: '$_id',
          top_tracks: {
            '$slice': [
              '$top_tracks',
              5
            ]
          }
        }
      }
    ],
    cursor: {},
    '$db': 'spotify'
  },
  ok: 1
}
